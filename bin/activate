##
# File activates VirtPHP for BASH
##


# Function to make sure used variables are removed
# before environment is setup
deactivate () {

    if [ "$_OLD_VIRTUAL_PATH" ] ; then
        PATH="$_OLD_VIRTUAL_PATH"
        export PATH
        unset _OLD_VIRTUAL_PATH
    fi

    if [ "$PHP_INI_SCAN_DIR" ] ; then
        PHP_INI_SCAN_DIR=""
        export PHP_INI_SCAN_DIR 
        unset PHP_INI_SCAN_DIR 
    fi

    if [ "$_OLD_PS1" ] ; then
        PS1="$_OLD_PS1"
        export PS1 
        unset _OLD_PS1 
    fi

    # This should detect bash and zsh, which have a hash command that must
    # be called to get it to forget past commands.  Without forgetting
    # past commands the $PATH changes we made may not be respected
    if [ -n "$BASH" -o -n "$ZSH_VERSION" ] ; then
        hash -r 2>/dev/null
    fi

}

# Reset variables
deactivate

# Get current directory
CURRENT="`pwd`/Env/"
export CURRENT

# Add current path to the bash PATH
_OLD_VIRTUAL_PATH="$PATH"
PATH="$CURRENT/bin:$PATH"
export PATH

# Used for testing 
# PATH="$_OLD_VIRTUAL_PATH"
# export PATH
# echo $PATH

# Create a PHP_INI_SCAN_DIR path
PHP_INI_SCAN_DIR="$CURRENT/etc/php"
export PHP_INI_SCAN_DIR

# Update the shell prompt
if [ -n "$PS1" ] ; then
    _OLD_PS1=$PS1
    PS1="(Env) $PS1"
    export PS1
fi

# This should detect bash and zsh, which have a hash command that must
# be called to get it to forget past commands.  Without forgetting
# past commands the $PATH changes we made may not be respected
if [ -n "$BASH" -o -n "$ZSH_VERSION" ] ; then
    hash -r 2>/dev/null
fi
